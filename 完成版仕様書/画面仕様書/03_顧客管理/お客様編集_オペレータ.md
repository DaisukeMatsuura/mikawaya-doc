# お客様編集

ステータス: 確定
ユーザー種別: オペレータ
概要: 顧客の登録・編集
機能番号: M-001
画面種別: モーダル

# お客様編集（モーダル）

## Figmaデザイン

※お客様作成モーダルと同一レイアウト（編集モード）

---

## 🎯 画面の目的

オペレータが既存のお客様（顧客）情報を編集する。

---

## 📊 表示データ項目

### 基本情報

| 項目名 | データ型 | 必須 | 備考 |
| --- | --- | --- | --- |
| 会員番号 | String | - | 表示のみ（編集不可） |
| 担当店舗 | Enum | ◯ | セレクト（店舗マスタから選択） |
| お客様担当コンシェルジュ | Enum | - | セレクト（選択店舗のコンシェルジュ） |
| 登録経路 | Enum | - | セレクト |

### お客様情報

| 項目名 | データ型 | 必須 | 備考 |
| --- | --- | --- | --- |
| 取引先/お客様名：姓 | String | ◯ |  |
| 取引先/お客様名：名 | String | ◯ |  |
| ふりがな：姓 | String | - | ひらがな入力 |
| ふりがな：名 | String | - | ひらがな入力 |
| 性別 | Enum | - | 男 / 女 / 未選択 |
| 生年月日 | Date | - | 日付選択 |
| 自宅電話 | String | - | 電話番号形式 |
| 携帯電話 | String | - | 電話番号形式 |
| メールアドレス | String | - | メール形式 |
| 特技・趣味など | String | - | テキストエリア |
| お客様情報備考 | String | - | テキストエリア |

### お客様のお住まい情報

| 項目名 | データ型 | 必須 | 備考 |
| --- | --- | --- | --- |
| 郵便番号 | String | - | 自動住所入力対応 |
| 都道府県 | Enum | - | セレクト |
| 市区郡 | String | - |  |
| 町名・番地 | String | - |  |

---

## ⚙️ 機能・操作

| 要素 | 操作 | 動作 |
| --- | --- | --- |
| 担当店舗セレクト | 選択 | 店舗を選択（コンシェルジュリストが連動更新） |
| お客様担当コンシェルジュセレクト | 選択 | 選択店舗のコンシェルジュから選択 |
| 登録経路セレクト | 選択 | 登録経路を選択 |
| 姓・名入力欄 | 入力 | 姓は必須バリデーション |
| ふりがな入力欄 | 入力 | ひらがなのみ許可 |
| 性別セレクト | 選択 | 性別を選択 |
| 生年月日 | 選択 | カレンダーから日付選択 |
| 電話番号入力欄 | 入力 | 電話番号形式バリデーション |
| メールアドレス入力欄 | 入力 | メール形式バリデーション |
| 郵便番号入力欄 | 入力 | 7桁入力で住所自動補完 |
| キャンセルボタン | クリック | モーダルを閉じる（入力内容は破棄） |
| 保存ボタン | クリック | 変更を保存 |

---

## 🔄 状態パターン

| 状態 | 表示内容 |
| --- | --- |
| 編集モード | 既存データを表示 |
| バリデーションエラー | 該当項目を赤枠 + エラーメッセージ |
| 処理中 | ボタンをローディング表示 |
| 保存完了 | モーダルを閉じる、詳細画面を更新、トースト通知「お客様情報を更新しました」 |

---

## 🔐 権限

| ユーザー種別 | 閲覧 | 実行 |
| --- | --- | --- |
| 管理者 | ◯ | ◯ |
| オペレータ | ◯ | ◯ |
| パートナー | △（自店舗のみ） | ◯ |
| コンシェルジュ | ✕ | ✕ |

---

## 📝 備考

- API: `PATCH /api/operator/customers/{id}`
- 会員番号は編集不可（自動採番のため）
- 担当店舗を変更すると、お客様担当コンシェルジュの選択肢が連動更新
- 郵便番号入力で住所を自動補完（郵便番号API使用）
- ふりがなは自動変換なし（手動入力）
- 電話番号はハイフンあり/なし両方許可
- 変更履歴は監査ログに記録

---

## バリデーションルール

| 項目 | ルール |
| --- | --- |
| 担当店舗 | 必須 |
| 姓 | 必須、50文字以内 |
| 名 | 必須、50文字以内 |
| ふりがな | ひらがなのみ |
| 電話番号 | 半角数字・ハイフンのみ |
| メールアドレス | メール形式 |
| 郵便番号 | 7桁の数字 |

---

## エラーメッセージ

| 条件 | メッセージ |
| --- | --- |
| 姓が未入力 | 「姓を入力してください」 |
| 名が未入力 | 「名を入力してください」 |
| 担当店舗が未選択 | 「担当店舗を選択してください」 |
| メール形式不正 | 「正しいメールアドレス形式で入力してください」 |
| 電話番号形式不正 | 「正しい電話番号形式で入力してください」 |
