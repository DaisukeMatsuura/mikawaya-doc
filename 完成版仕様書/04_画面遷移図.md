# まごころサポート - 画面遷移図

**作成日**: 2026-01-09
**バージョン**: 1.0
**ステータス**: 確定

---

## 📋 目次

1. [全体画面遷移図](#全体画面遷移図)
2. [ロール別画面フロー](#ロール別画面フロー)
3. [主要ユースケースフロー](#主要ユースケースフロー)
4. [状態遷移図](#状態遷移図)

---

## 全体画面遷移図

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        まごころサポート 全体画面遷移図                            │
└─────────────────────────────────────────────────────────────────────────────────┘

                                ┌─────────────┐
                                │   ログイン   │
                                │   /login    │
                                └──────┬──────┘
                                       │
                     ┌─────────────────┼─────────────────┐
                     │                 │                 │
                     ▼                 │                 │
           ┌─────────────────┐         │       ┌─────────────────┐
           │  パスワード再設定  │         │       │   エラー画面    │
           │ /password-reset │         │       │    /error      │
           └─────────────────┘         │       └─────────────────┘
                                       │
         ┌─────────────────────────────┼─────────────────────────────┐
         │                             │                             │
         │     認証後（ロール判定）       │                             │
         │                             │                             │
┌────────┴────────┐          ┌────────┴────────┐          ┌────────┴────────┐
│                 │          │                 │          │                 │
│   管理者         │          │  オペレータ      │          │  パートナー      │
│   /admin/*      │          │  /operator/*    │          │  /partner/*     │
│                 │          │                 │          │                 │
└────────┬────────┘          └────────┬────────┘          └────────┬────────┘
         │                             │                             │
         │                             │                             │
         │                             │                   ┌────────┴────────┐
         │                             │                   │                 │
         │                             │                   │  コンシェルジュ   │
         │                             │                   │  /concierge/*   │
         │                             │                   │                 │
         │                             │                   └─────────────────┘
         │                             │
         ▼                             ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              各ロールのダッシュボード                             │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## ロール別画面フロー

### 管理者（Admin）フロー

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              管理者 画面フロー                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐
│  ダッシュボード   │
│ /admin/dashboard│
└────────┬────────┘
         │
         ├─────────────────┬─────────────────┬─────────────────┬─────────────────┐
         │                 │                 │                 │                 │
         ▼                 ▼                 ▼                 ▼                 ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│ アカウント管理   │ │  パートナー管理  │ │  サービス管理   │ │  種別管理       │ │  （将来）       │
│ /admin/accounts │ │ /admin/partners │ │ /admin/services │ │ /admin/master/* │ │                 │
└────────┬────────┘ └────────┬────────┘ └────────┬────────┘ └────────┬────────┘ └─────────────────┘
         │                   │                   │                   │
         │                   │                   │                   │
         ▼                   ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│ [モーダル]       │ │  パートナー詳細  │ │  サービス詳細   │ │ [モーダル]      │
│  アカウント発行  │ │ /admin/partners │ │ /admin/services │ │ 種別登録・編集  │
│                 │ │      /:id      │ │      /:id      │ │                │
└─────────────────┘ └────────┬────────┘ └────────┬────────┘ └─────────────────┘
                             │                   │
                             ▼                   ▼
                    ┌─────────────────┐ ┌─────────────────┐
                    │ [モーダル]       │ │ [モーダル]       │
                    │ パートナー登録   │ │ サービス登録    │
                    │      ・編集     │ │     ・編集      │
                    └─────────────────┘ └─────────────────┘
```

### オペレーター（Operator）フロー

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            オペレーター 画面フロー                                │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────┐
│    ダッシュボード    │
│ /operator/dashboard │
└──────────┬──────────┘
           │
           ├───────────────────────┬───────────────────────┐
           │                       │                       │
           ▼                       ▼                       ▼
┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
│    お客様一覧       │ │      案件一覧       │ │    （将来）         │
│ /operator/customers │ │   /operator/cases   │ │                     │
└──────────┬──────────┘ └──────────┬──────────┘ └─────────────────────┘
           │                       │
           │                       │
           ▼                       ▼
┌─────────────────────┐ ┌─────────────────────┐
│    お客様詳細       │ │      案件詳細       │
│ /operator/customers │ │   /operator/cases   │
│       /:id         │ │        /:id        │
└──────────┬──────────┘ └──────────┬──────────┘
           │                       │
           │                       ├───────────────────────┐
           ▼                       ▼                       ▼
┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
│    [モーダル]       │ │    [モーダル]       │ │   [確認ダイアログ]   │
│   お客様作成        │ │   案件作成・編集    │ │    案件削除確認     │
└─────────────────────┘ └─────────────────────┘ └─────────────────────┘
```

### パートナー（Partner）フロー

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             パートナー 画面フロー                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────┐
│   ダッシュボード   │
│/partner/dashboard │
└─────────┬─────────┘
          │
          ├─────────────────┬─────────────────┬─────────────────┬─────────────────┐
          │                 │                 │                 │                 │
          ▼                 ▼                 ▼                 ▼                 ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│  お客様一覧     │ │    案件一覧     │ │ コンシェルジュ  │ │   店舗情報      │ │  （将来）       │
│/partner/        │ │ /partner/cases  │ │     一覧       │ │  /partner/store │ │                 │
│  customers     │ │                 │ │/partner/       │ │                 │ │                 │
│                 │ │                 │ │ concierges    │ │                 │ │                 │
└────────┬────────┘ └────────┬────────┘ └────────┬────────┘ └────────┬────────┘ └─────────────────┘
         │                   │                   │                   │
         ▼                   ▼                   ▼                   │
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐         │
│  お客様詳細     │ │    案件詳細     │ │ コンシェルジュ  │         │
│/partner/        │ │ /partner/cases  │ │     詳細       │         │
│ customers/:id  │ │      /:id      │ │/partner/       │         │
│                 │ │                 │ │concierges/:id │         │
└────────┬────────┘ └────────┬────────┘ └────────┬────────┘         │
         │                   │                   │                   │
         ▼                   ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   [モーダル]     │ │   [モーダル]     │ │   [モーダル]     │ │   [編集モード]   │
│ お客様作成・編集 │ │ 案件作成・編集   │ │ コンシェルジュ   │ │  店舗情報編集   │
│                 │ │                 │ │   登録・編集    │ │                 │
└─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘
```

### コンシェルジュ（Concierge）フロー【スマホ専用】

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          コンシェルジュ 画面フロー（スマホ）                       │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────┐
│    ダッシュボード    │  ← 本日の訪問予定表示
│/concierge/dashboard │
└──────────┬──────────┘
           │
           ├───────────────────────┬───────────────────────┐
           │                       │                       │
           ▼                       ▼                       ▼
┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
│    担当案件一覧     │ │    完了報告一覧     │ │    （将来）         │
│  /concierge/cases   │ │ /concierge/reports  │ │                     │
│                     │ │                     │ │                     │
│  ・進行中          │ │  ・未報告一覧       │ │                     │
│  ・本日予定        │ │  ・報告済み一覧     │ │                     │
└──────────┬──────────┘ └──────────┬──────────┘ └─────────────────────┘
           │                       │
           │                       │
           ▼                       │
┌─────────────────────┐            │
│      案件詳細       │            │
│  /concierge/cases   │            │
│       /:id         │            │
│                     │            │
│  ・顧客情報        │            │
│  ・訪問先          │            │
│  ・依頼内容        │            │
└──────────┬──────────┘            │
           │                       │
           │◄──────────────────────┘
           │
           ▼
┌─────────────────────┐
│     作業報告入力     │
│  /concierge/cases   │
│    /:id/report     │
│                     │
│  ・訪問日時        │
│  ・作業内容        │
│  ・お客様の様子    │
│  ・写真添付        │
│  ・下書き保存      │
│  ・報告完了        │
└─────────────────────┘
```

---

## 主要ユースケースフロー

### 1. 新規案件登録フロー（オペレーター）

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           新規案件登録フロー                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

  オペレーター                    システム                      データベース
       │                           │                              │
       │ 1. 案件一覧画面を開く      │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │ 2.「新規作成」ボタン押下   │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │        3. モーダル表示     │                              │
       │◄──────────────────────────│                              │
       │                           │                              │
       │ 4. 顧客選択（検索）        │                              │
       │──────────────────────────>│ 5. 顧客一覧取得               │
       │                           │─────────────────────────────>│
       │        6. 顧客候補表示     │◄─────────────────────────────│
       │◄──────────────────────────│                              │
       │                           │                              │
       │ 7. 顧客を選択             │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │ 8. サービス・日程入力      │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │ 9. パートナー選択         │                              │
       │──────────────────────────>│ 10. パートナー一覧取得        │
       │                           │─────────────────────────────>│
       │       11. パートナー表示   │◄─────────────────────────────│
       │◄──────────────────────────│                              │
       │                           │                              │
       │ 12.「保存」ボタン押下     │                              │
       │──────────────────────────>│ 13. バリデーション            │
       │                           │                              │
       │                           │ 14. 案件データ保存           │
       │                           │─────────────────────────────>│
       │                           │◄─────────────────────────────│
       │                           │                              │
       │    15. 成功トースト表示    │                              │
       │◄──────────────────────────│                              │
       │                           │                              │
       │    16. 一覧画面更新        │                              │
       │◄──────────────────────────│                              │
```

### 2. 作業報告提出フロー（コンシェルジュ）

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           作業報告提出フロー                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

  コンシェルジュ                  システム                      ストレージ
       │                           │                              │
       │ 1. 案件詳細画面を開く      │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │        2. 案件情報表示     │                              │
       │◄──────────────────────────│                              │
       │                           │                              │
       │ 3.「報告作成」ボタン押下   │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │        4. 報告画面表示     │                              │
       │◄──────────────────────────│                              │
       │                           │                              │
       │ 5. 作業内容入力           │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │ 6. 写真撮影・添付         │                              │
       │──────────────────────────>│ 7. 画像アップロード           │
       │                           │─────────────────────────────>│
       │        8. アップロード完了 │◄─────────────────────────────│
       │◄──────────────────────────│                              │
       │                           │                              │
       │ 9.「下書き保存」押下      │                              │
       │──────────────────────────>│ 10. 下書きデータ保存          │
       │                           │─────────────────────────────>│
       │       11. 保存完了トースト │◄─────────────────────────────│
       │◄──────────────────────────│                              │
       │                           │                              │
       │    （後日続きを入力）       │                              │
       │                           │                              │
       │ 12.「報告完了」押下       │                              │
       │──────────────────────────>│ 13. バリデーション            │
       │                           │                              │
       │                           │ 14. 報告データ保存           │
       │                           │ 15. 案件ステータス更新        │
       │                           │ 16. 通知送信（パートナーへ）   │
       │                           │─────────────────────────────>│
       │                           │◄─────────────────────────────│
       │                           │                              │
       │   17. 完了トースト表示     │                              │
       │◄──────────────────────────│                              │
       │                           │                              │
       │   18. 案件一覧へ遷移       │                              │
       │◄──────────────────────────│                              │
```

### 3. アカウント発行フロー（管理者）

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           アカウント発行フロー                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

  管理者                          システム                      メールサーバー
       │                           │                              │
       │ 1. アカウント一覧画面を開く│                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │ 2.「アカウント発行」押下   │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │        3. モーダル表示     │                              │
       │◄──────────────────────────│                              │
       │                           │                              │
       │ 4. メールアドレス入力      │                              │
       │ 5. ユーザー種別選択        │                              │
       │ 6. （パートナー/コンシェルジュ │                          │
       │    の場合）所属選択        │                              │
       │──────────────────────────>│                              │
       │                           │                              │
       │ 7.「発行」ボタン押下       │                              │
       │──────────────────────────>│ 8. バリデーション             │
       │                           │    - メール形式チェック       │
       │                           │    - 重複チェック             │
       │                           │                              │
       │                           │ 9. アカウント作成             │
       │                           │ 10. 初期パスワード生成        │
       │                           │                              │
       │                           │ 11. 招待メール送信            │
       │                           │─────────────────────────────>│
       │                           │◄─────────────────────────────│
       │                           │                              │
       │   12. 成功トースト表示     │                              │
       │   「招待メールを送信しました」│                            │
       │◄──────────────────────────│                              │
       │                           │                              │
       │   13. 一覧画面更新         │                              │
       │◄──────────────────────────│                              │
```

---

## 状態遷移図

### 案件（Case）ステータス遷移

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           案件ステータス遷移図                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

                              ┌──────────────────┐
                              │      draft       │
                              │     （下書き）    │
                              └────────┬─────────┘
                                       │
                                       │ 保存確定
                                       ▼
                              ┌──────────────────┐
                              │     pending      │
                              │   （確認待ち）    │
                              └────────┬─────────┘
                                       │
                     ┌─────────────────┼─────────────────┐
                     │                 │                 │
                     │ キャンセル       │ 確定            │
                     ▼                 │                 │
           ┌──────────────────┐        │                 │
           │    cancelled     │        │                 │
           │  （キャンセル）   │        │                 │
           └──────────────────┘        │                 │
                                       ▼                 │
                              ┌──────────────────┐       │
                              │    confirmed     │       │
                              │     （確定）      │       │
                              └────────┬─────────┘       │
                                       │                 │
                                       │ コンシェルジュ  │
                                       │ アサイン         │
                                       ▼                 │
                              ┌──────────────────┐       │
                              │    assigned      │       │
                              │  （アサイン済）   │       │
                              └────────┬─────────┘       │
                                       │                 │
                                       │ 作業開始        │
                                       ▼                 │
                              ┌──────────────────┐       │
                              │   in_progress    │       │
                              │    （対応中）     │◄──────┘
                              └────────┬─────────┘   再アサイン
                                       │
                                       │ 作業完了
                                       ▼
                              ┌──────────────────┐
                              │    completed     │
                              │   （作業完了）    │
                              └────────┬─────────┘
                                       │
                                       │ 報告提出
                                       ▼
                              ┌──────────────────┐
                              │    reported      │
                              │   （報告済み）    │
                              └──────────────────┘
```

### ステータス遷移許可マトリックス

| 現在の状態 | → draft | → pending | → confirmed | → assigned | → in_progress | → completed | → reported | → cancelled |
|-----------|---------|-----------|-------------|------------|---------------|-------------|------------|-------------|
| draft | - | ◯ | ✕ | ✕ | ✕ | ✕ | ✕ | ◯ |
| pending | ✕ | - | ◯ | ✕ | ✕ | ✕ | ✕ | ◯ |
| confirmed | ✕ | ✕ | - | ◯ | ✕ | ✕ | ✕ | ◯ |
| assigned | ✕ | ✕ | ✕ | - | ◯ | ✕ | ✕ | ◯ |
| in_progress | ✕ | ✕ | ✕ | ◯ | - | ◯ | ✕ | ◯ |
| completed | ✕ | ✕ | ✕ | ✕ | ✕ | - | ◯ | ✕ |
| reported | ✕ | ✕ | ✕ | ✕ | ✕ | ✕ | - | ✕ |
| cancelled | ✕ | ✕ | ✕ | ✕ | ✕ | ✕ | ✕ | - |

### 報告（Report）ステータス遷移

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           報告ステータス遷移図                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

                              ┌──────────────────┐
                              │      draft       │
                              │     （下書き）    │
                              └────────┬─────────┘
                                       │
                                       │ 報告完了
                                       ▼
                              ┌──────────────────┐
                              │    submitted     │
                              │    （提出済み）   │
                              └────────┬─────────┘
                                       │
                                       │ 承認（将来機能）
                                       ▼
                              ┌──────────────────┐
                              │    approved      │
                              │    （承認済み）   │
                              └──────────────────┘
```

---

## 画面一覧サマリー

### ロール別画面数

| ロール | 一覧画面 | 詳細画面 | モーダル | ダッシュボード | 合計 |
|-------|---------|---------|---------|--------------|------|
| 共通（認証） | - | - | - | - | 2 |
| 管理者 | 4 | 2 | 5 | 1 | 12 |
| オペレータ | 2 | 2 | 2 | 1 | 7 |
| パートナー | 3 | 3 | 4 | 1 | 11 |
| コンシェルジュ | 2 | 2 | 1 | 1 | 6 |
| エラー | - | - | - | - | 1 |
| **合計** | | | | | **39** |

※ 一部画面はロール間で共通利用

---

**作成者**: Claude Code
**最終更新**: 2026-01-09
